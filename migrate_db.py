#!/usr/bin/env python3
# -*- coding: utf-8 -*-
"""
Database Migration Script
ุณูุฑูุจุช ูุชุฑุญูู ูุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
"""

import sqlite3
import os

DATABASE = 'medical_records.db'

def migrate_database():
    """ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช ูููุณุฎุฉ ุงูุฌุฏูุฏุฉ"""
    print("๐ ุจุฏุก ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช...")
    
    # ุญุฐู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุฏููุฉ ุฅุฐุง ูุงูุช ููุฌูุฏุฉ
    if os.path.exists(DATABASE):
        backup_name = f'medical_records_backup_{os.path.getmtime(DATABASE)}.db'
        print(f"๐ฆ ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ: {backup_name}")
        
        try:
            # ูุณุฎ ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุฏููุฉ
            import shutil
            shutil.copy2(DATABASE, backup_name)
            print("โ ุชู ุฅูุดุงุก ุงููุณุฎุฉ ุงูุงุญุชูุงุทูุฉ ุจูุฌุงุญ!")
        except Exception as e:
            print(f"โ๏ธ  ุชุญุฐูุฑ: ูู ูุชู ุฅูุดุงุก ูุณุฎุฉ ุงุญุชูุงุทูุฉ: {e}")
        
        # ุญุฐู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุฏููุฉ
        try:
            os.remove(DATABASE)
            print("๐๏ธ  ุชู ุญุฐู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุฏููุฉ")
        except Exception as e:
            print(f"โ ุฎุทุฃ ูู ุญุฐู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงููุฏููุฉ: {e}")
            return False
    
    print("โจ ุณูุชู ุฅูุดุงุก ูุงุนุฏุฉ ุจูุงูุงุช ุฌุฏูุฏุฉ ุนูุฏ ุชุดุบูู ุงูุชุทุจูู")
    print("โ ุงูุชูู ุงูุชุญุฏูุซ!")
    return True

if __name__ == '__main__':
    print("=" * 50)
    print("๐ง ุฃุฏุงุฉ ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช")
    print("=" * 50)
    print()
    
    if migrate_database():
        print()
        print("โ ุงููุธุงู ุฌุงูุฒ ููุนูู!")
        print("ุดุบู ุงูุชุทุจูู ุงูุขู ุจุงุณุชุฎุฏุงู: python app.py")
    else:
        print()
        print("โ ูุดู ุงูุชุญุฏูุซ!")
        print("ูุฑุฌู ุงูุชูุงุตู ูุน ุงูุฏุนู ุงูููู")
