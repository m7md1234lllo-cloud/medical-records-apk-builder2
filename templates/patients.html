{% extends "base.html" %}

{% block title %}Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø¶Ù‰{% endblock %}

{% block content %}
<div class="page-header">
    <h2>ğŸ“‹ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø±Ø¶Ù‰</h2>
    <div class="header-actions">
        <div class="search-mini">
            <input type="text" id="quickSearch" placeholder="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹..." />
            <button class="voice-btn" data-target="quickSearch">ğŸ¤</button>
        </div>
        <a href="{{ url_for('new_patient') }}" class="btn btn-primary">â• Ù…Ø±ÙŠØ¶ Ø¬Ø¯ÙŠØ¯</a>
    </div>
</div>

<div class="stats-summary">
    <div class="stat-mini">
        <span class="stat-number">{{ patients|length }}</span>
        <span class="stat-label">Ù…Ø±ÙŠØ¶</span>
    </div>
    <div class="stat-mini success">
        <span class="stat-number">{{ patients|selectattr('total_debt', 'equalto', 0)|list|length }}</span>
        <span class="stat-label">Ù…Ø³Ø¯Ø¯</span>
    </div>
    <div class="stat-mini danger">
        <span class="stat-number">{{ patients|selectattr('total_debt', 'greaterthan', 0)|list|length }}</span>
        <span class="stat-label">Ø¹Ù„ÙŠÙ‡ Ø¯ÙŠÙ†</span>
    </div>
</div>

<div class="patients-cards">
    {% for patient in patients %}
    <div class="patient-card {% if patient['total_debt'] > 0 %}has-debt{% endif %}" 
         onclick="window.location.href='/patient/{{ patient['id'] }}'">
        <div class="patient-card-header">
            <div class="patient-main-info">
                <h3>{{ patient['name'] }}</h3>
                <div class="patient-meta">
                    {% if patient['age'] %}
                    <span>ğŸ‚ {{ patient['age'] }} Ø³Ù†Ø©</span>
                    {% endif %}
                    {% if patient['gender'] %}
                    <span>{{ 'ğŸ‘¨' if patient['gender'] == 'Ø°ÙƒØ±' else 'ğŸ‘©' }}</span>
                    {% endif %}
                    {% if patient['blood_type'] %}
                    <span class="blood-badge">ğŸ©¸ {{ patient['blood_type'] }}</span>
                    {% endif %}
                </div>
            </div>
            {% if patient['total_debt'] > 0 %}
            <div class="debt-badge-large">
                <div class="debt-label">Ø¯ÙŠÙ†</div>
                <div class="debt-value">{{ "%.2f"|format(patient['total_debt']) }}</div>
            </div>
            {% else %}
            <div class="paid-badge">âœ… Ù…Ø³Ø¯Ø¯</div>
            {% endif %}
        </div>
        
        <div class="patient-card-body">
            {% if patient['phone'] %}
            <div class="info-line">
                <span class="icon">ğŸ“±</span>
                <span>{{ patient['phone'] }}</span>
            </div>
            {% endif %}
            
            <div class="financial-mini">
                <div class="fin-item">
                    <span class="label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø³ÙˆÙ…</span>
                    <span class="value">{{ "%.2f"|format(patient['total_charges']) }}</span>
                </div>
                <div class="fin-item success-text">
                    <span class="label">Ø§Ù„Ù…Ø¯ÙÙˆØ¹</span>
                    <span class="value">{{ "%.2f"|format(patient['total_paid']) }}</span>
                </div>
            </div>
        </div>
        
        <div class="patient-card-footer">
            <a href="{{ url_for('patient_details', patient_id=patient['id']) }}" 
               class="card-btn" onclick="event.stopPropagation()">
                <span>Ø¹Ø±Ø¶ Ø§Ù„Ù…Ù„Ù</span>
            </a>
            <a href="{{ url_for('new_visit', patient_id=patient['id']) }}" 
               class="card-btn primary" onclick="event.stopPropagation()">
                <span>Ø²ÙŠØ§Ø±Ø© Ø¬Ø¯ÙŠØ¯Ø©</span>
            </a>
        </div>
    </div>
    {% else %}
    <div class="no-patients">
        <div class="empty-state">
            <div class="empty-icon">ğŸ‘¥</div>
            <h3>Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø±Ø¶Ù‰ Ù…Ø³Ø¬Ù„ÙŠÙ†</h3>
            <p>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙŠØ¶ Ø¬Ø¯ÙŠØ¯</p>
            <a href="{{ url_for('new_patient') }}" class="btn btn-primary">â• Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙŠØ¶ Ø¬Ø¯ÙŠØ¯</a>
        </div>
    </div>
    {% endfor %}
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/voice.js') }}"></script>
<script>
// Quick search in patients list
document.getElementById('quickSearch').addEventListener('input', function(e) {
    const query = e.target.value.toLowerCase();
    const cards = document.querySelectorAll('.patient-card');
    
    cards.forEach(card => {
        const text = card.textContent.toLowerCase();
        if (text.includes(query)) {
            card.style.display = 'block';
        } else {
            card.style.display = 'none';
        }
    });
});
</script>
{% endblock %}
