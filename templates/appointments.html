{% extends "base.html" %}

{% block title %}Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯{% endblock %}

{% block content %}
<div class="page-header">
    <h2>ğŸ“… Ø§Ù„Ù…ÙˆØ§Ø¹ÙŠØ¯</h2>
</div>

<div class="appointments-container">
    {% if appointments %}
    <div class="appointments-grid">
        {% for appointment in appointments %}
        <div class="appointment-card status-{{ appointment['status']|replace(' ', '-') }}">
            <div class="appointment-header">
                <div class="appointment-date">
                    <span class="date-icon">ğŸ“…</span>
                    <div>
                        <strong>{{ appointment['appointment_date'] }}</strong>
                        <br>
                        <span class="time">ğŸ• {{ appointment['appointment_time'] }}</span>
                    </div>
                </div>
                <span class="status-badge status-{{ appointment['status']|replace(' ', '-') }}">
                    {{ appointment['status'] }}
                </span>
            </div>
            
            <div class="appointment-body">
                <div class="patient-info">
                    <strong>ğŸ‘¤ {{ appointment['patient_name'] }}</strong>
                    {% if appointment['phone'] %}
                    <br><small>ğŸ“± {{ appointment['phone'] }}</small>
                    {% endif %}
                </div>
                
                {% if appointment['reason'] %}
                <div class="appointment-reason">
                    <strong>Ø§Ù„Ø³Ø¨Ø¨:</strong> {{ appointment['reason'] }}
                </div>
                {% endif %}
                
                {% if appointment['notes'] %}
                <div class="appointment-notes">
                    <small>ğŸ“ {{ appointment['notes'] }}</small>
                </div>
                {% endif %}
            </div>
            
            <div class="appointment-actions">
                <a href="{{ url_for('patient_details', patient_id=appointment['patient_id']) }}" 
                   class="btn btn-small">Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø±ÙŠØ¶</a>
                
                {% if appointment['status'] == 'Ù…Ø¬Ø¯ÙˆÙ„' %}
                <button class="btn btn-small btn-success" 
                        onclick="updateStatus({{ appointment['id'] }}, 'ØªÙ…')">
                    âœ… ØªÙ…
                </button>
                <button class="btn btn-small" 
                        onclick="updateStatus({{ appointment['id'] }}, 'Ù…Ù„ØºÙŠ')">
                    âŒ Ø¥Ù„ØºØ§Ø¡
                </button>
                {% endif %}
                
                <button class="btn btn-small btn-danger" 
                        onclick="deleteAppointment({{ appointment['id'] }})">
                    ğŸ—‘ï¸ Ø­Ø°Ù
                </button>
            </div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    <div class="no-appointments">
        <p class="no-data">ğŸ“… Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ÙˆØ§Ø¹ÙŠØ¯ Ù…Ø³Ø¬Ù„Ø©</p>
        <p>ÙŠÙ…ÙƒÙ†Ùƒ Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¹Ø¯ Ù…Ù† ØµÙØ­Ø© Ø§Ù„Ù…Ø±ÙŠØ¶</p>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_scripts %}
<script>
async function updateStatus(appointmentId, status) {
    if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ¹Ø¯ Ø¥Ù„Ù‰ "' + status + '"ØŸ')) {
        return;
    }
    
    try {
        const response = await fetch('/appointment/update/' + appointmentId, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({ status: status })
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('âœ… ØªÙ… ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„Ù…ÙˆØ¹Ø¯');
            location.reload();
        }
    } catch (error) {
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ¹Ø¯');
        console.error(error);
    }
}

async function deleteAppointment(appointmentId) {
    if (!confirm('âš ï¸ Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¹Ø¯ØŸ')) {
        return;
    }
    
    try {
        const response = await fetch('/appointment/delete/' + appointmentId, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            }
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¹Ø¯');
            location.reload();
        }
    } catch (error) {
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¹Ø¯');
        console.error(error);
    }
}
</script>
{% endblock %}
