{% extends "base.html" %}

{% block title %}Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙŠØ¶ Ø¬Ø¯ÙŠØ¯{% endblock %}

{% block content %}
<div class="form-container">
    <h2>â• Ø¥Ø¶Ø§ÙØ© Ù…Ø±ÙŠØ¶ Ø¬Ø¯ÙŠØ¯</h2>
    
    <form id="newPatientForm">
        <!-- Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ© -->
        <div class="form-section">
            <h3>ğŸ‘¤ Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø´Ø®ØµÙŠØ©</h3>
            
            <div class="form-group">
                <label for="name">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„ *</label>
                <div class="input-with-voice">
                    <input type="text" id="name" name="name" required>
                    <button type="button" class="voice-btn" data-target="name">ğŸ¤</button>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="age">Ø§Ù„Ø¹Ù…Ø±</label>
                    <input type="number" id="age" name="age">
                </div>

                <div class="form-group">
                    <label for="gender">Ø§Ù„Ø¬Ù†Ø³</label>
                    <select id="gender" name="gender">
                        <option value="">Ø§Ø®ØªØ±...</option>
                        <option value="Ø°ÙƒØ±">Ø°ÙƒØ±</option>
                        <option value="Ø£Ù†Ø«Ù‰">Ø£Ù†Ø«Ù‰</option>
                    </select>
                </div>
            </div>

            <div class="form-row">
                <div class="form-group">
                    <label for="phone">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <div class="input-with-voice">
                        <input type="tel" id="phone" name="phone">
                        <button type="button" class="voice-btn" data-target="phone">ğŸ¤</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="national_id">Ø±Ù‚Ù… Ø§Ù„Ù‡ÙˆÙŠØ©</label>
                    <div class="input-with-voice">
                        <input type="text" id="national_id" name="national_id">
                        <button type="button" class="voice-btn" data-target="national_id">ğŸ¤</button>
                    </div>
                </div>
            </div>

            <div class="form-group">
                <label for="email">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                <input type="email" id="email" name="email">
            </div>

            <div class="form-group">
                <label for="address">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                <div class="input-with-voice">
                    <textarea id="address" name="address" rows="2"></textarea>
                    <button type="button" class="voice-btn" data-target="address">ğŸ¤</button>
                </div>
            </div>
        </div>

        <!-- Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ© -->
        <div class="form-section">
            <h3>ğŸ©º Ø§Ù„Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·Ø¨ÙŠØ©</h3>
            
            <div class="form-group">
                <label for="blood_type">ÙØµÙŠÙ„Ø© Ø§Ù„Ø¯Ù…</label>
                <select id="blood_type" name="blood_type">
                    <option value="">Ø§Ø®ØªØ±...</option>
                    <option value="A+">A+</option>
                    <option value="A-">A-</option>
                    <option value="B+">B+</option>
                    <option value="B-">B-</option>
                    <option value="AB+">AB+</option>
                    <option value="AB-">AB-</option>
                    <option value="O+">O+</option>
                    <option value="O-">O-</option>
                </select>
            </div>

            <div class="form-group">
                <label for="allergies">Ø§Ù„Ø­Ø³Ø§Ø³ÙŠØ© (Ø£Ø¯ÙˆÙŠØ©ØŒ Ø·Ø¹Ø§Ù…ØŒ Ø¥Ù„Ø®)</label>
                <div class="input-with-voice">
                    <textarea id="allergies" name="allergies" rows="2" 
                              placeholder="Ù…Ø«Ø§Ù„: Ø­Ø³Ø§Ø³ÙŠØ© Ù…Ù† Ø§Ù„Ø¨Ù†Ø³Ù„ÙŠÙ†ØŒ Ø§Ù„Ù…ÙƒØ³Ø±Ø§Øª"></textarea>
                    <button type="button" class="voice-btn" data-target="allergies">ğŸ¤</button>
                </div>
            </div>

            <div class="form-group">
                <label for="chronic_diseases">Ø§Ù„Ø£Ù…Ø±Ø§Ø¶ Ø§Ù„Ù…Ø²Ù…Ù†Ø©</label>
                <div class="input-with-voice">
                    <textarea id="chronic_diseases" name="chronic_diseases" rows="2"
                              placeholder="Ù…Ø«Ø§Ù„: Ø³ÙƒØ±ÙŠØŒ Ø¶ØºØ·ØŒ Ø±Ø¨Ùˆ"></textarea>
                    <button type="button" class="voice-btn" data-target="chronic_diseases">ğŸ¤</button>
                </div>
            </div>

            <div class="form-group">
                <label for="current_medications">Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„Ø­Ø§Ù„ÙŠØ©</label>
                <div class="input-with-voice">
                    <textarea id="current_medications" name="current_medications" rows="2"
                              placeholder="Ø§Ù„Ø£Ø¯ÙˆÙŠØ© Ø§Ù„ØªÙŠ ÙŠØªÙ†Ø§ÙˆÙ„Ù‡Ø§ Ø§Ù„Ù…Ø±ÙŠØ¶ Ø­Ø§Ù„ÙŠØ§Ù‹"></textarea>
                    <button type="button" class="voice-btn" data-target="current_medications">ğŸ¤</button>
                </div>
            </div>
        </div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦ -->
        <div class="form-section">
            <h3>ğŸš¨ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="emergency_contact">Ø§Ø³Ù… Ø¬Ù‡Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ù„Ù„Ø·ÙˆØ§Ø±Ø¦</label>
                    <div class="input-with-voice">
                        <input type="text" id="emergency_contact" name="emergency_contact">
                        <button type="button" class="voice-btn" data-target="emergency_contact">ğŸ¤</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="emergency_phone">Ø±Ù‚Ù… Ù‡Ø§ØªÙ Ø§Ù„Ø·ÙˆØ§Ø±Ø¦</label>
                    <div class="input-with-voice">
                        <input type="tel" id="emergency_phone" name="emergency_phone">
                        <button type="button" class="voice-btn" data-target="emergency_phone">ğŸ¤</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ† -->
        <div class="form-section">
            <h3>ğŸ’³ Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„ØªØ£Ù…ÙŠÙ†</h3>
            
            <div class="form-row">
                <div class="form-group">
                    <label for="insurance_company">Ø´Ø±ÙƒØ© Ø§Ù„ØªØ£Ù…ÙŠÙ†</label>
                    <div class="input-with-voice">
                        <input type="text" id="insurance_company" name="insurance_company">
                        <button type="button" class="voice-btn" data-target="insurance_company">ğŸ¤</button>
                    </div>
                </div>

                <div class="form-group">
                    <label for="insurance_number">Ø±Ù‚Ù… Ø§Ù„Ø¨ÙˆÙ„ÙŠØµØ©</label>
                    <div class="input-with-voice">
                        <input type="text" id="insurance_number" name="insurance_number">
                        <button type="button" class="voice-btn" data-target="insurance_number">ğŸ¤</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Ù…Ù„Ø§Ø­Ø¸Ø§Øª -->
        <div class="form-section">
            <h3>ğŸ“ Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©</h3>
            
            <div class="form-group">
                <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                <div class="input-with-voice">
                    <textarea id="notes" name="notes" rows="3"></textarea>
                    <button type="button" class="voice-btn" data-target="notes">ğŸ¤</button>
                </div>
            </div>
        </div>

        <div class="form-actions">
            <button type="submit" class="btn btn-primary">ğŸ’¾ Ø­ÙØ¸ Ø§Ù„Ù…Ø±ÙŠØ¶</button>
            <a href="{{ url_for('patients_list') }}" class="btn btn-secondary">Ø¥Ù„ØºØ§Ø¡</a>
        </div>
    </form>
</div>
{% endblock %}

{% block extra_scripts %}
<script src="{{ url_for('static', filename='js/voice.js') }}"></script>
<script>
document.getElementById('newPatientForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const formData = {
        name: document.getElementById('name').value,
        age: document.getElementById('age').value,
        gender: document.getElementById('gender').value,
        phone: document.getElementById('phone').value,
        address: document.getElementById('address').value,
        email: document.getElementById('email').value,
        national_id: document.getElementById('national_id').value,
        blood_type: document.getElementById('blood_type').value,
        allergies: document.getElementById('allergies').value,
        chronic_diseases: document.getElementById('chronic_diseases').value,
        current_medications: document.getElementById('current_medications').value,
        emergency_contact: document.getElementById('emergency_contact').value,
        emergency_phone: document.getElementById('emergency_phone').value,
        insurance_company: document.getElementById('insurance_company').value,
        insurance_number: document.getElementById('insurance_number').value,
        notes: document.getElementById('notes').value
    };
    
    try {
        const response = await fetch('/patient/new', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(formData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            alert('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙŠØ¶ Ø¨Ù†Ø¬Ø§Ø­!');
            window.location.href = '/patient/' + result.patient_id;
        }
    } catch (error) {
        alert('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø±ÙŠØ¶');
        console.error(error);
    }
});
</script>
{% endblock %}
